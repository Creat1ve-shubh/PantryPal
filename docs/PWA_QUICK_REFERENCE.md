# PWA Testing - Quick Reference

## üì± What is PWA?

**Progressive Web App** = Web app + Native app features

- ‚úÖ Install to home screen (like native app)
- ‚úÖ Work offline (cached content)
- ‚úÖ Fast loading (service worker caching)
- ‚úÖ No app store needed
- ‚úÖ Responsive design

---

## üèóÔ∏è How PantryPal Implements PWA

| Component          | Location                              | Purpose                                     |
| ------------------ | ------------------------------------- | ------------------------------------------- |
| **Manifest**       | `dist/manifest.webmanifest`           | App metadata, icons, display mode           |
| **Service Worker** | `dist/sw.js`                          | Offline caching, background sync            |
| **Icons**          | `dist/pwa-192x192.png`, `512x512.png` | App icons (various sizes)                   |
| **Caching**        | `vite.config.ts`                      | Strategy rules (Cache First, Network First) |
| **Install Hook**   | `client/src/hooks/use-pwa-install.ts` | Trigger install dialog                      |

---

## üöÄ Quick Start - Manual Testing

### Step 1: Build PWA

```bash
npm run build
```

**Verify files created**:

```bash
ls dist/manifest.webmanifest   # ‚úÖ Should exist
ls dist/sw.js                  # ‚úÖ Should exist
ls dist/pwa-*.png              # ‚úÖ Should exist
```

### Step 2: Start Local Server

```bash
npm run dev
# or
npm run start
```

### Step 3: Test in Browser

**Open DevTools (F12) ‚Üí Application tab**

#### Check Manifest:

- Go to **Application ‚Üí Manifest**
- Should show:
  ```json
  {
    "name": "PantryPal",
    "display": "standalone",
    "icons": [...]
  }
  ```
- No errors

#### Check Service Worker:

- Go to **Application ‚Üí Service Workers**
- Should show: "Status: activated and running"
- No error messages

#### Test Install:

- Address bar ‚Üí Look for **install icon** (right side)
- Click ‚Üí Dialog appears "Install PantryPal?"
- Click "Install"
- App opens in fullscreen window (no address bar)

#### Test Offline:

1. Go to **Network tab**
2. Check **"Offline"** checkbox
3. Reload page (Ctrl+R)
   - ‚úÖ Page loads instantly (from cache)
   - ‚úÖ No network requests shown
4. Uncheck Offline
5. Page reconnects to server

#### Check Caches:

- Go to **Application ‚Üí Cache Storage**
- Should show multiple caches:
  - `google-fonts-cache`
  - `api-cache`
  - `PantryPal-v*`

---

## üìù Key Files Explained

### `vite.config.ts` - PWA Configuration

```typescript
VitePWA({
  registerType: "autoUpdate",    // Auto-update service worker
  manifest: {
    name: "PantryPal",
    display: "standalone",       // Hides browser UI
    icons: [...]
  },
  workbox: {
    runtimeCaching: [
      {
        urlPattern: /\/api\/.*/i,
        handler: "NetworkFirst",  // Try network first, fallback to cache
        options: {
          cacheName: "api-cache",
          expiration: {
            maxAgeSeconds: 86400  // 24 hours
          }
        }
      }
    ]
  }
})
```

### `manifest.webmanifest` - App Metadata

Auto-generated from vite config. Tells browser:

- App name, icon, colors
- How to display (fullscreen vs windowed)
- Start URL, theme color

### `sw.js` - Service Worker

Auto-generated by Vite PWA. Handles:

- Caching strategy (what/when to cache)
- Offline support (serving cached content)
- Background tasks

### `use-pwa-install.ts` - Install Prompt Hook

```typescript
const { isInstallable, install } = usePWAInstall();

if (isInstallable) {
  <button onClick={install}>Install App</button>;
}
```

---

## üîç Testing Scenarios

### Scenario 1: User Installs App

```
1. Visit http://localhost:5000
2. Install icon appears in address bar
3. Click ‚Üí Install dialog
4. Click "Install" in dialog
5. App launches in fullscreen window
6. App icon in taskbar
‚úÖ Success: App installed as standalone
```

### Scenario 2: User Goes Offline

```
1. Open DevTools Network tab
2. Check "Offline"
3. Reload page
4. App loads instantly from cache
5. Navigate around (cached pages work)
6. Try API call (shows error gracefully)
7. Uncheck Offline, refresh
8. App reconnects, syncs data
‚úÖ Success: Works offline, recovers online
```

### Scenario 3: App Updates

```
1. App deployed with new version
2. User opens installed app
3. Service Worker checks for update
4. If new version found, downloads in background
5. On next reload, new version used
6. User sees "app updated" message (optional)
‚úÖ Success: App auto-updates without user action
```

---

## ‚ö†Ô∏è Common Issues & Fixes

| Issue                         | Check                                 | Fix                                        |
| ----------------------------- | ------------------------------------- | ------------------------------------------ |
| Install button doesn't appear | - HTTPS? (required, except localhost) | Rebuild: `npm run build`                   |
|                               | - Manifest exists?                    | Check `dist/manifest.webmanifest`          |
|                               | - Icons exist?                        | Check `dist/pwa-*.png`                     |
| Offline page blank            | - Cache Storage has entries?          | Check DevTools Application ‚Üí Cache Storage |
|                               | - Service Worker running?             | DevTools ‚Üí Service Workers ‚Üí Status        |
| Update doesn't install        | - registerType = "autoUpdate"?        | Check `vite.config.ts`                     |
|                               | - Clear cache?                        | DevTools ‚Üí Storage ‚Üí Clear site data       |

---

## üéØ Testing Checklist

Before deployment, verify:

### Build

- [ ] `npm run build` completes
- [ ] `dist/manifest.webmanifest` exists
- [ ] `dist/sw.js` exists
- [ ] Icons exist: `dist/pwa-*.png`

### Installation

- [ ] Install button appears
- [ ] Install succeeds
- [ ] App opens fullscreen
- [ ] App in taskbar/home screen

### Offline

- [ ] DevTools Network ‚Üí Offline ‚Üí Reload
- [ ] Page loads from cache
- [ ] No network requests
- [ ] Can navigate around
- [ ] API calls show error gracefully

### Cache

- [ ] DevTools Application ‚Üí Cache Storage shows caches
- [ ] Multiple cache types present
- [ ] API responses cached

### Service Worker

- [ ] DevTools Service Workers shows entry
- [ ] Status: "activated and running"
- [ ] No error messages

### Performance

- [ ] First load: < 3 seconds
- [ ] Offline reload: < 500ms
- [ ] Cache size reasonable (< 100MB)

---

## üîó Browser Support

| Browser     | Desktop    | Mobile     | Install                      |
| ----------- | ---------- | ---------- | ---------------------------- |
| **Chrome**  | ‚úÖ Yes     | ‚úÖ Yes     | ‚úÖ Auto popup                |
| **Edge**    | ‚úÖ Yes     | ‚úÖ Yes     | ‚úÖ Auto popup                |
| **Firefox** | ‚úÖ Yes     | ‚ö†Ô∏è Limited | ‚ùå No                        |
| **Safari**  | ‚ö†Ô∏è Partial | ‚úÖ Yes     | Manual (Share ‚Üí Add to Home) |
| **Opera**   | ‚úÖ Yes     | ‚úÖ Yes     | ‚úÖ Auto popup                |

---

## üìö Detailed Guides

For complete information, see:

- **[PWA_GUIDE.md](PWA_GUIDE.md)** - Full implementation details
- **[PWA_TESTING_CHECKLIST.md](PWA_TESTING_CHECKLIST.md)** - Complete test scenarios

---

## üöÄ One-Command Test

```bash
# Build and verify PWA
bash scripts/test-pwa.sh        # Linux/Mac
scripts/test-pwa.bat            # Windows
```

Or manually:

```bash
npm run build
# Then open http://localhost:5000 and follow testing scenarios above
```

---

## üí° Key Points

1. **PWA = Install + Offline + Fast**

   - Users can install like native app
   - Works when internet down
   - Loads from cache (instant)

2. **Vite PWA Auto-Generates Assets**

   - Manifest: app metadata
   - Service Worker: caching logic
   - Icons: app appearance

3. **Test on Real Device**

   - Install from address bar (Chrome) or Share menu (Safari)
   - Test offline with airplane mode
   - Check taskbar/home screen

4. **HTTPS Required** (except localhost)

   - Production must use HTTPS
   - Service worker only works over secure connection

5. **Auto-Updates**
   - Service worker checks for new version
   - Installs automatically in background
   - No user action needed (except refresh)

---

**Status**: ‚úÖ PWA Fully Implemented & Ready to Test
**Last Updated**: January 7, 2026
